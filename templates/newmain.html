<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Faster beehive">
    <meta name="keywords" content="HTML, CSS, JavaScript">
    <meta name="author" content="Ralph King">
    <title>FastHive</title>
    <link rel="icon" href="../static/logo.png" type="image/icon type">
    <style>
.dropdown-content,.header-bar,.menu{background-color:var(--main-color)}.dropdown-content a,.menu a{display:block;text-decoration:none;color:#fff}.header-bar,.menu,td,th{padding:10px}.dropdown-content a:hover,.menu a:hover,.second-navbar button.active,table th{background-color:#ffa000}.task-item a,.task-item p,.task-item ul li a{overflow-wrap:break-word}:root{--main-color:gray}body{font-family:Arial,sans-serif;margin:0;padding:0;background-color:#f9f9f9}.header-bar{color:#fff;display:flex;justify-content:space-between;align-items:center;margin-bottom:0}.dropdown{position:relative;display:inline-block}.dropdown-content{display:none;position:absolute;min-width:160px;box-shadow:0 8px 16px 0 rgba(0,0,0,.2);z-index:1;right:0}.dropdown-content a{padding:12px 16px;text-align:center}.dropdown:hover .dropdown-content,section.active{display:block}.menu{text-align:center}.menu a{padding:15px 20px;margin:5px;border-radius:5px;font-size:17px;text-align:center}.link-box,td,th{border:1px solid #ddd;text-align:center}section{display:none}.container{width:90%;max-width:1200px;margin:20px auto;padding:20px;background-color:#fff;box-shadow:0 0 10px rgba(0,0,0,.1)}.print-area,table{margin-top:20px}.link-box,.task-item{background-color:#fafafa;box-sizing:border-box}h1,h2{text-align:center;color:#333}table{width:100%;border-collapse:collapse}table th{color:#fff}table.behaviour th{background-color:red}table.rewards th{background-color:#4caf50}tr:nth-child(2n){background-color:#f2f2f2}a.button,button{padding:10px 20px;background-color:var(--main-color);color:#fff;font-size:16px;text-decoration:none}button{display:block;margin:20px auto;border:none;cursor:pointer;border-radius:8px}button a{text-decoration:none;color:#fff}a{text-decoration:none}a.button{display:inline-block;border-radius:8px}.second-navbar button:hover,button:hover{background-color:#ff8c00}@media (max-width:768px){.header-bar{padding:5px}.menu{padding:10px}button{padding:12px 24px;font-size:18px}}.tables-container{display:flex;flex-direction:column;gap:20px}.links-container{display:flex;flex-wrap:wrap;gap:20px;justify-content:center}.link-box{padding:20px;border-radius:8px;text-decoration:none;color:#333;width:calc(33.333% - 40px)}.link-box h3{margin:0;font-size:18px}.link-box p{margin:10px 0 0;font-size:14px}.link-box:hover{background-color:#f0f0f0}@media (max-width:768px){.link-box{width:calc(50% - 40px);padding:15px}.link-box h3{font-size:16px}.link-box p{font-size:12px}}@media (min-width:768px){.header-bar{flex-wrap:nowrap}.tables-container{flex-direction:row}.tables-container table{width:48%}}@media print{.print-area,body{margin:0;padding:0}@page{size:A4 landscape;margin:10mm}.print-area{width:100%}table{width:100%;max-height:100%;page-break-inside:avoid;border-collapse:collapse;font-size:11px}td,th{padding:4px;border:1px solid #000}body>:not(.print-area){display:none}}.scroll-list{display:flex;flex-wrap:wrap;gap:20px}.task-item{border:1px solid #ddd;padding:20px;border-radius:10px;flex:1 1 calc(33.333% - 20px);box-shadow:0 0 5px rgba(0,0,0,.1);margin-bottom:20px;word-wrap:break-word;overflow:hidden}.task-item ul{padding-left:20px}@media (max-width:768px){.task-item{flex:1 1 calc(50% - 20px)}}.task-item h2{margin-top:0;font-size:20px}.task-item p{margin:10px 0;font-size:16px}.task-item a{word-break:break-all}.container3{display:flex;flex-wrap:wrap;justify-content:center;padding:20px}.event-box{border:1px solid #ccc;border-radius:10px;padding:15px;margin:10px;box-shadow:0 4px 8px rgba(0,0,0,.1);background-color:#fff;width:calc(33% - 40px);box-sizing:border-box}.event-title{font-size:1.2em;margin-bottom:10px}.signup-button{display:inline-block;padding:10px 20px;font-size:1em;color:#fff;background-color:#ffa000;border:none;border-radius:5px;text-decoration:none;text-align:center}.signup-button:hover{background-color:#cf8300}@media (max-width:768px){.event-box{width:calc(50% - 40px)}}@media (max-width:480px){button{width:auto;padding:10px;font-size:15px}.link-box{width:calc(100% - 40px);padding:10px}.link-box h3{font-size:14px}.link-box p{font-size:10px}.task-item{flex:1 1 calc(100% - 20px)}.event-box{width:calc(100% - 40px)}}.table-scroll{overflow-x:auto}@media (max-width:768px){.table-scroll{display:block;width:100%;overflow-x:scroll}table{font-size:8px}td,th{white-space:nowrap}}.info-block{flex:0 0 auto;width:100px;padding:10px;background-color:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.1);text-align:center;display:flex;flex-direction:column;justify-content:center;align-items:center;margin:5px}.info-block h1{font-size:16px;color:#ffa000;margin-bottom:10px}.info-block p{font-size:20px;font-weight:700;color:#333;margin:0}.attendance-block .circle{width:80px;height:80px;background:conic-gradient(#ffa000 {{ Attendance }}%,#e0e0e0 {{ Attendance }}%);border-radius:50%;display:flex;justify-content:center;align-items:center;margin-top:10px;box-shadow:0 4px 8px rgba(0,0,0,.1)}.attendance-block .circle-inner{width:70px;height:70px;background-color:#fff;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:18px;font-weight:700;color:#ffa000}.circle span{color:#333}.container4{display:flex;flex-wrap:wrap;padding:6px;justify-content:center}.event,.lesson-box{background-color:#fff;padding:15px}.second-navbar{display:flex;justify-content:center;margin:20px 0}.second-navbar button{padding:10px 20px;margin:0 10px;background-color:var(--main-color);color:#fff;border:none;border-radius:25px;cursor:pointer;font-size:16px}.event .content,.lesson-box h2{margin-bottom:10px}.lesson-box{border:1px solid #ccc;border-radius:10px;margin:10px;box-shadow:0 4px 8px rgba(0,0,0,.1);width:100%;box-sizing:border-box}.lesson-box h2{font-size:1.5em;color:#ffa000}.lesson-box p{font-size:16px;margin:5px 0;text-align:center}.container5{width:80%;margin:0 auto}.event{border:1px solid #ddd;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.1);margin:20px 0;overflow:hidden}.event h2{margin-top:0}.event .images img{display:block;max-width:100%;height:auto;margin-top:10px}
    </style>
</head>
<body>

    <div class="header-bar">
        <div class="header-item">{{ name }}</div>

        <div class="header-item"><a href="/">Home</a></div>

        <div class="header-item">Users: {{ users }}</div>
        <div class="dropdown">
            <button class="dropbtn">Menu</button>
            <div class="dropdown-content">
                <a href="#" onclick="showSection('general')">General</a>
                <a href="#" onclick="showSection('noticeboard')">NoticeBoard</a>
                <a href="#" onclick="showSection('leaderboards')">Leaderboards</a>
                <a href="#" onclick="showSection('assignments')">Assignments</a>
                <a href="#" onclick="showSection('timetable')">Timetable</a>
                <a href="#" onclick="showSection('events')">Events</a>
                <a href="#" onclick="showSection('links')">Links</a>
            </div>
        </div>
    </div>

    <section id="general" class="container active">
        <div class="container4">

            <div class="lesson-box">
                <h2>Next Lesson</h2>
                {% set details = lesson_details.split('Next lesson: ')[1] %}
                <p>{{ details }}</p>
            </div>
            <div class="info-block">
                <h1>Balance</h1>
                <p id="balance">{{ balance }}</p>
            </div>
            
        <div class="info-block">
            <h1>Print</h1>
            <p>{{ print }}</p>
        </div>
        <div class="info-block">
            <h1>Form</h1>
            <p>{{ form }}</p>
        </div>

        <div class="info-block">
            <h1>Reward</h1>
            <p>{{ Reward }}</p>
        </div>
        <div class="info-block">
            <h1>Behaviour</h1>
            <p>{{ Behaviour }}</p>
        </div>
        <div class="info-block">
            <h1>Lates</h1>
            <p>{{ Lates }}</p>
        </div>
        <div class="info-block">
            <h1>Absences</h1>
            <p>{{ Absences }}</p>
        </div>
        <div class="info-block attendance-block">
            <h1>Attendance</h1>
            <div class="circle">
                <div class="circle-inner">
                    <span id="attendance">{{ Attendance }}%</span>
                </div>
            </div>
        </div>

        
    </div>
    </section>

    <section id="noticeboard" class="container">
        <div class="container5">
            <h1>Events</h1>
            {% for event in noticeboard %}
                <div class="event">
                    <h2>{{ event.title }}</h2>
                    <div class="content">
                        {{ event.content|safe }}
                    </div>
                    {% if event.images %}
                        <div class="images">
                            {% for image_id in event.images %}
                                <img src="../static/beehive/{{ image_id }}.webp" alt="Event Image">
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </section>
    
    <section id="leaderboards" class="container">
        <h2>Leaderboards: Behaviour/Rewards</h2>
        <div class="tables-container">
            <table class="behaviour">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Form</th>
                        <th>Behaviour Points</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in behave['top_behaviour_points'] %}
                    <tr>
                        <td>{{ student.name }}</td>
                        <td>{{ student.form }}</td>
                        <td>{{ student.behaviourPoints }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <table class="rewards">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Form</th>
                        <th>Reward Points</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in reward['top_reward_points'] %}
                    <tr>
                        <td>{{ student.name }}</td>
                        <td>{{ student.form }}</td>
                        <td>{{ student.rewardPoints }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>

    <section id="assignments" class="container">
        <div class="second-navbar">
            <button class="active" onclick="showAssignments('unsubmitted')">Unsubmitted</button>
            <button onclick="showAssignments('submitted')">Submitted</button>
        </div>

        <section id="unsubmitted" class="container active">
            <h1>Unsubmitted Assignments</h1>
            <div class="scroll-list">
                {% for id, task in data.items() %}
                    {% if not task.completed %}
                    <div class="task-item" data-assignment-id="{{ id }}">
                        <h2>{{ task.title }}</h2>
                        <p><strong>Deadline:</strong> {{ task.deadline }}</p>
                        <p><strong>Set by:</strong> {{ task.set_by }}</p>
                        <p><strong>Description:</strong> {{ task.description|safe }}</p>
                        <p>
                        {% for link in task.links %}
                        <li><a style="color: #333;" href="{{ link }}">{{ link }}</a></li>
                        {% endfor %}
                         </p>
                         <p>
                            
                            {% for link in task.files %}
                            <li><a style="color: #333;" href="https://beehive.lionhearttrust.org.uk/#/main/assignments">{{ task.files[link] }}</a></li>
                            {% endfor %}
                             </p>
                    <button onclick="submitAssignment('{{ id }}')">Submit</button>                                        
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </section>

        <section id="submitted" class="container">
            <h1>Submitted Assignments</h1>
            <div class="scroll-list">
                {% for id, task in data|dictsort(true)|reverse %}
                    {% if task.completed %}
                    <div class="task-item">
                        <h2>{{ task.title }}</h2>
                        <p><strong>Submitted On:</strong> {{ task.submission_date }}</p>
                        <p><strong>Set by:</strong> {{ task.set_by }}</p>
                        <p><strong>Description:</strong> {{ task.description|safe }}</p>
                        <p>
                        {% for link in task.links %}
                        <li><a style="color: #333;" href="{{ link }}">{{ link }}</a></li>
                        {% endfor %}
                         </p>
                         <p>
                        {% for link in task.files %}
                        <li><a style="color: #333;" href="https://beehive.lionhearttrust.org.uk/#/main/assignments">{{ task.files[link] }}</a></li>
                        {% endfor %}
                         </p>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </section>        
    </section>

<section id="timetable" class="container">
    <button onclick="printTimetable()">Print Timetable</button>
    <div class="print-area" id="printArea">
        <div class="table-wrapper">
            <div class="table-scroll">
                <table>
                    <thead>
                        <tr>
                            <th>Period</th>
                            <th>Monday</th>
                            <th>Tuesday</th>
                            <th>Wednesday</th>
                            <th>Thursday</th>
                            <th>Friday</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set days_of_week = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'] %}
                        {% set next_day_found = false %}

                        {% for period in range(1, 12) %}
                            <tr>
                                <td>{{ period }}</td>
                                {% for day in days_of_week %}
                                    {% if not next_day_found and day in timetable %}
                                        {% set next_day_found = true %}
                                    {% endif %}
                                    
                                    <td>
                                        {% if next_day_found and period|string in timetable[day] %}
                                            {{ timetable[day][period|string]['subject'] }}<br>
                                            {{ timetable[day][period|string]['teacher'] }}<br>
                                            {{ timetable[day][period|string]['room'] }}<br>
                                            {{ timetable[day][period|string]['times'] }}
                                        {% else %}
                                            Free
                                        {% endif %}
                                    </td>
                                {% endfor %}
                            </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>
    <section id="links">
        <div class="container">
            <h1>Links</h1>
            <div class="links-container">
                <a href="https://www.kerboodle.com/" target="_blank" class="link-box">
                    <h3>Kerboodle</h3>
                    <p>textbooks</p>
                </a>
                {% for title, details in links.items() %}
                <a href="{{ details.url }}" target="_blank" class="link-box">
                    <h3>{{ title }}</h3>
                    <p>{{ details.desk }}</p>
                </a>
                {% endfor %}
            </div>
        </div>
    </section>

    <section id="events">
        <div class="container3">
            {% for event_id, event in events.items() %}
            <div class="event-box">
                <div class="event-title">{{ event['title'] }}</div>
                {% if event['allowsignupfrom'] and not event['sighnedup'] %}
                <a href="/events/{{ event_id }}" class="signup-button">Sign Up</a>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    <script>
        function submitAssignment(id) {
            fetch(`/submit/${id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const assignmentElement = document.querySelector(`[data-assignment-id="${id}"]`);
                        if (assignmentElement) {
                            assignmentElement.remove();
                        }
                        const submittedSection = document.getElementById('submitted');
                        const unsubmittedAssignment = document.querySelector(`#unsubmitted [data-assignment-id="${id}"]`);
                        if (unsubmittedAssignment) {
                            const clone = unsubmittedAssignment.cloneNode(true);
                            const submitButton = clone.querySelector('button');
                            if (submitButton) {
                                submitButton.remove();
                            }
                            submittedSection.querySelector('.scroll-list').appendChild(clone);
                            unsubmittedAssignment.remove();
                        }
                    }
                });
        }
        function showSection(sectionId) {
            var sections = document.querySelectorAll('section');
            sections.forEach(function(section) {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        function printTimetable() {
        var printWindow = window.open('', '', 'height=600,width=800');
        var printContents = document.getElementById('printArea').innerHTML;
        
        printWindow.document.write(`
            <html>
                <head>
                    <title>Timetable</title>
                    <style>
                        @page { size: A4 landscape; margin: 10mm; }
                        body { margin: 0; padding: 0; }
                        table { 
                            width: 100%;
                            border-collapse: collapse;
                            font-size: 11px;
                            page-break-inside: avoid;
                        }
                        th, td { 
                            padding: 4px;
                            border: 1px solid #000;
                            text-align: left;
                        }
                    </style>
                </head>
                <body>
                    <div class="print-area">${printContents}</div>
                </body>
            </html>
        `);
        
        printWindow.document.close();
        printWindow.focus();
        setTimeout(() => printWindow.print(), 250);
    }

        document.addEventListener("DOMContentLoaded", function() {
        var balanceElement = document.getElementById("balance");
        var balanceValue = parseFloat(balanceElement.textContent);

        if (balanceValue < 2.50) {
            balanceElement.style.color = "red";
        }
        var attendanceElement = document.getElementById("attendance");
        var attendanceValue = parseFloat(attendanceElement.textContent);

        if (attendanceValue < 90) {
            attendanceElement.style.color = "red";
        }
    });

    function showAssignments(type) {
            document.getElementById('unsubmitted').classList.remove('active');
            document.getElementById('submitted').classList.remove('active');
            document.getElementById(type).classList.add('active');
            document.querySelectorAll('.second-navbar button').forEach(button => {
                button.classList.remove('active');
            });
            event.target.classList.add('active');
        }
    </script>

</body>
</html>